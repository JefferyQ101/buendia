#!/bin/bash
# Purpose of this script is to (re)generate the package sources list,
# such that it contains a reference to the buendia package server. The
# buendia package server may be running on this machine or on a different
# machine that is reachable via a network connection.

# There are two packages that could provide the network location of the
# package server: the settings package and the package server itself.
# Both will create a `pkgserver` settings file containing this variable.
if [ -f /usr/share/buendia/site/pkgserver ]; then
	# If the settings file exists, load it.
	. /usr/share/buendia/site/pkgserver
fi

# Determine the network location (URL) of the package server.
# Either the `PKGSERVER_URL` variable is set by the settings file,
# or we assume that the package server can be fond at the default location.
URL=${PKGSERVER_URL-"http://packages.local"}

# Generate the pkgclient apt sources list containing the pkgserver repository.
cat <<EOF > /etc/apt/sources.list.d/pkgclient.list
deb [arch=all] $URL stable main
EOF
