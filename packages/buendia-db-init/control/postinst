#!/bin/bash

set -e
. /usr/share/buendia/site/id
. /usr/share/buendia/site/mysql

# Create a fresh new database populated with the initial data.
export MYSQL_USER=root
export MYSQL_PASSWORD=$MYSQL_ROOT_PASSWORD
buendia-mysql-load openmrs /usr/share/buendia/db/init.zip

# Add site-specific initial data.
site_sql=/usr/share/buendia/db/site-${SITE_ID}.sql
[ -f $site_sql ] && mysql -uroot -p$MYSQL_ROOT_PASSWORD openmrs < $site_sql

# Reapply the OpenMRS user/password/person setup used by the Buendia server.
config_server=/usr/share/buendia/config.d/server
[ -f $config_server ] && $config_server
