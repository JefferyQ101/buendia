#!/bin/bash

set -e
. /usr/share/buendia/site/mysql

case $1 in
    install|upgrade)
        service mysql start

        if ! mysql -uroot -p$MYSQL_ROOT_PASSWORD -e ''; then
            echo "MySQL configuration problem: cannot connect as root."
            exit 1
        fi

        if mysql -uroot -p$MYSQL_ROOT_PASSWORD -e '' openmrs 2>/dev/null; then
            echo
            echo "Installing buendia-db-init would destroy all data in the"
            echo "existing MySQL database 'openmrs'!  Not installing."
            echo
            exit 1
        fi
        ;;

    *) exit 1
esac
