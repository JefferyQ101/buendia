#!/bin/bash

set -e; . /usr/share/buendia/utils.sh

case $1 in
    configure|abort-upgrade|abort-remove|abort-deconfigure)
        # Initialize settings
        /usr/share/buendia/config.d/pkgserver

        # Make all subdirectories executable and readable
        chmod -R +rX /usr/share/buendia/packages

        # Disable the default nginx configuration
        rm -f /etc/nginx/sites-enabled/default

        # Enable the pkgserver configuration
        ln -sf ../sites-available/buendia-packages /etc/nginx/sites-enabled

        # Restart services
        service nginx restart
        /etc/init.d/udev restart || true
        ;;

    *) exit 1
esac
