#!/bin/bash

set -e
cd $(dirname $0)
source remote-execution.sh

if [ "$1" == "-h" ]; then
  echo "Usage: $0"
  echo
  echo "Installs Debian on an Edison in a chroot directory at /debian."
  exit 1
fi

if echo '[ -f /debian/etc/debian_installed ]' | do_in_yocto; then
  echo "Debian is already installed."
  exit 0
fi

echo
echo "Installing Debian (takes ~5 minutes)..."
echo

connect_ethernet
run_script_in_yocto yocto/install-debian

# Install enter-debian and enter-debian-nomount in /usr/local/bin.
run_script_in_yocto yocto/enter-debian echo
run_script_in_yocto yocto/enter-debian-nomount echo
$scp -p debian/bashrc $target:/debian/root/.bashrc

cat <<EOF | do_in_debian
set -e
echo UTC > /etc/timezone
dpkg-reconfigure -f noninteractive tzdata

apt-get update

# When installing packages, install only the required dependencies.
echo 'APT::Install-Recommends "0";' > /etc/apt/apt.conf.d/01norecommend
echo 'APT::Install-Suggests "0";' >> /etc/apt/apt.conf.d/01norecommend

mkdir -p /usr/local/bin
touch /etc/debian_installed
EOF
