#!/bin/bash

set -e
cd $(dirname $0)
source remote-execution.sh
sql=$1
database=$2
password=$3

if [ "$1" == "-h" -o ! -n "$password" ]; then
  echo "Usage: $0 <commands.sql> <mysql-database> <mysql-password>"
  echo
  echo "Loads a SQL file into a MySQL database on an Edison using the"
  echo "MySQL user dump@localhost."
  exit 1
fi

echo
echo "Loading $sql into OpenMRS database..."
echo

connect_ethernet
$scp $sql $target:/debian/tmp/tmp.sql
cat <<EOF | do_in_debian
set -e
service mysql start
mysql -udump -p"$password" "$database" < /tmp/tmp.sql
rm /tmp/tmp.sql
sleep 5
service mysql stop
EOF
